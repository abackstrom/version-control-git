/* Simple JavaScript Inheritance
 * By John Resig http://ejohn.org/
 * MIT Licensed.
 */// Inspired by base2 and Prototype
function git_canvas(a){function i(a){e=new Branches;d=new Commits;g=null;f=0;for(var b=0,h=a.length;b<h;b++){var i=a[b],j=null,k=null,l=null,m=null;i.branch=i.branch||"master";k=e.create(i.branch);l=i.staged||!1;i.parents==null?g?m=[g.hash]:m=[]:m=i.parents;j=new Commit(i.hash,{branch:k,parents:m,staged:l});j.commit_number=f++;d.push(j);g=j}return c}function j(a,g){var i={};if(typeof g!="undefined"){for(var j in h)h.hasOwnProperty(j)&&(i[j]=h[j]);h.branch_sep=g.branch_sep||h.branch_sep;h.commits_sep=g.commits_sep||h.commits_sep;h.stroke=g.stroke||h.stroke;h.radius=g.radius||h.radius}b=Raphael(a,(f-1)*h.commits_sep+2*h.radius+h.stroke,(e.branch_count-1)*h.branch_sep+2*h.radius+h.stroke);d.each(function(){l(this)});d.each(function(){m(this)});typeof g!="undefined"&&(h=i);return c}function k(a,c){var d=["M",a.x,a.y];c.branch===a.branch?d.push("L",c.x,c.y):c.branch.num<a.branch.num?d.push("L",c.x+h.commits_sep/2,a.y,"L",c.x,c.y):d.push("L",a.x-h.commits_sep/2,c.y,"L",c.x,c.y);d=b.path(d.join(","));c.branch.num<a.branch.num?d.attr("stroke",a.branch.color):d.attr("stroke",c.branch.color);d.attr("stroke-width",h.stroke);a.staged&&d.attr("stroke-dasharray",".")}function l(a){var b=a.branch,c=h.commits_sep*a.commit_number+h.radius+h.stroke/2,e=h.branch_sep*b.num+h.radius+h.stroke/2;a.x=c;a.y=e;for(var f=0,g=a.parents.length;f<g;f++){var i=d.get(a.parents[f]);k(a,i)}}function m(a){var c=b.circle(a.x,a.y,h.radius);c.attr("fill","white");c.attr("stroke","#444");c.attr("stroke-width",h.stroke);a.staged&&c.attr("stroke-dasharray",".")}var b=null,c={},d=null,e=null,f=0,g=null,h=a||{};h.branch_sep=h.branch_sep||50;h.commits_sep=h.commits_sep||60;h.stroke=h.stroke||6;h.radius=h.radius||15;c.commits=i;c.draw=j;return c}(function(){var a=!1,b=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(c){function g(){!a&&this.init&&this.init.apply(this,arguments)}var d=this.prototype;a=!0;var e=new this;a=!1;for(var f in c)e[f]=typeof c[f]=="function"&&typeof d[f]=="function"&&b.test(c[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);this._super=c;return e}}(f,c[f]):c[f];g.prototype=e;g.prototype.constructor=g;g.extend=arguments.callee;return g}})();var HashCollection=Class.extend({init:function(){this.childrenHash={};this.children=[]},push:function(a){var b=this.children.push(a);this.childrenHash[a[this.id_field]]=b-1},each:function(a){for(var b=0,c=this.children.length;b<c;b++){commit=this.children[b];a.apply(commit)}},get:function(a){var b=this.childrenHash[a];return this.children[b]},exists:function(a){return typeof this.get(a)!="undefined"}}),Commits=HashCollection.extend({init:function(){this.id_field="hash";this._super()}}),Branches=HashCollection.extend({init:function(){this.line_colors=["#D4262F","#2F8F59","#F78623","#2389F7","#DF23F7"];this.id_field="name";this.branch_count=0;this._super()},create:function(a){if(this.exists(a))return this.get(a);a=new Branch(a);a.num=this.branch_count++;a.color=this.line_colors.shift();this.push(a);return a}}),Branch=Class.extend({init:function(a){this.name=a}}),Commit=Class.extend({init:function(a,b){this.parents=new Commits;typeof b.parents!="undefined"&&!(b.parents instanceof Array)&&(b.parents=[b.parents]);this.hash=a;this.branch=b.branch;this.parents=b.parents||[];this.staged=b.staged||!1}});